---
title: Exercise 1.18
layout: sicp
has_math: true
---

The procedure for multiplication defined in [1.17]({{site.url}}/writings/sicp_exercises/1-17) generates a recursive process that uses a logarithmic number of steps as well as a logarithmic amount of space. However, the following procedure generates an iterative process that uses a constant amount of space:

```scheme
(define (halve x)
  (/ x 2))

(define (double x)
  (+ x x))

(define (fast-multiply-iter a b n)
  (cond ((= b 0)
      n)
     ((even? b)
      (fast-multiply-iter (double a) (halve b) n))
     (else
      (fast-multiply-iter a (- b 1) (+ n a)))))

(define (fast-multiply a b)
  (fast-multiply-iter a b 0)
```

We can prove the correctness of the above code by observing that the quantity $$ab + n$$ remains invariant. If $$b$$ is even, then in the next iteration, let $$et a'=2a, b'=b/2, n'=n$$. Then:

$$
\begin{align*}
a'b' + n' &= 2a * b/2 + n\\
          &= 2a/1 * b/2 + n\\
          &= 2ab/2 + n\\
          &= ab + n
\end{align*}
$$

If $$n$$ is odd, then for $$a'=a, b'=b-1, n'=n+a$$:

$$
\begin{align*}
a'b' + n' &= a(b - 1) + n + a\\
          &= ab - a + n + a\\
          &= ab + n
\end{align*}
$$
